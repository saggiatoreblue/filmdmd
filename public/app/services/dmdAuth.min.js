dmdApp.factory("dmdAuth",function(d,c,a,b){return{authenticateUser:function(g,f){var e=a.defer();d.post("/login",{username:g,password:f}).then(function(i){if(i.data.success){var h=new b();angular.extend(h,i.data.user);c.currentUser=h;e.resolve(true)}else{e.resolve(false)}});return e.promise},createUser:function(g){var f=new b(g);var e=a.defer();f.$save().then(function(){c.currentUser=f;e.resolve()},function(h){e.reject(h.data.reason)});return e.promise},updateCurrentUser:function(f){var e=a.defer();var g=angular.copy(c.currentUser);angular.extend(g,f);g.$update().then(function(){c.currentUser=g;e.resolve()},function(h){e.reject(h.data.reason)});return e.promise},addReject:function(g){var f=a.defer();var e=c.currentUser;e.rejects.unshift(g);e.$update().then(function(){c.currentUser.rejects=e.rejects;f.resolve()},function(h){f.reject(h.data.reason)});return f.promise},addLater:function(g){var f=a.defer();var e=c.currentUser;e.later.unshift(g);e.$update().then(function(){c.currentUser.later=e.later;f.resolve()},function(h){f.reject(h.data.reason)});return f.promise},addWatched:function(g){var f=a.defer();var e=c.currentUser;e.watched.unshift(g);e.$update().then(function(){c.currentUser.watched=e.watched;f.resolve()},function(h){f.reject(h.data.reason)});return f.promise},removeReject:function(h){var g=a.defer();var f=c.currentUser;var e=f.rejects.indexOf(h);f.rejects.splice(e,1);f.$update().then(function(){c.currentUser.rejects=f.rejects;g.resolve()},function(i){g.reject(i.data.reason)});return g.promise},removeLater:function(h){var g=a.defer();var f=c.currentUser;var e=f.later.indexOf(h);f.later.splice(e,1);f.$update().then(function(){c.currentUser.later=f.later;g.resolve()},function(i){g.reject(i.data.reason)});return g.promise},removeWatched:function(h){var g=a.defer();var f=c.currentUser;var e=f.watched.indexOf(h);f.watched.splice(e,1);f.$update().then(function(){c.currentUser.watched=f.watched;g.resolve()},function(i){g.reject(i.data.reason)});return g.promise},logoutUser:function(){var e=a.defer();d.post("/logout",{logout:true}).then(function(){c.currentUser=undefined;e.resolve()});return e.promise},authorizeCurrentUserForRoute:function(e){if(c.isAuthorized(e)){return true}else{return a.reject("not authorized")}},authorizeAuthenticatedUserForRoute:function(){if(c.isAuthenticated()){return true}else{return a.reject("not authorized")}}}});